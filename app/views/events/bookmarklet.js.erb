document.body.appendChild(document.createElement('script')).src='http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js';

var d=document,
    w=window,
    e=w.getSelection,
    k=d.getSelection,
    x=d.selection,
    s=( e ? e() : (k) ? k() : ( x ? x.createRange() : 0)),
    serialized = "";

for (var i=0; i<s.rangeCount; i++) {
    serialized += XMLSerializer().serializeToString(s.getRangeAt(i).cloneContents());
}

//console.log("rangeCount: "+s.rangeCount);
console.log("serialized: "+serialized);
    
var f='http://localhost:3000/bm',
    l=d.location,
    e=encodeURIComponent,
    p='?v=3&u='+e(l.href) +'&t='+e(d.title) +'&s='+e(s),
    u=f+p;

try {
    if (!/^(.*\.)?localhost[^.]*$/.test(l.host))
	throw(0);
    tstbklt();
} catch(z) {
    a = function() {
	if(!w.open(u,'t','toolbar=0,resizable=0,status=1,width=450,height=430')) l.href=u;
    };
    //if (/Firefox/.test(navigator.userAgent)) setTimeout(a,0);
    //else a();
} void(0)
